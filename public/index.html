<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SODAPOP 2.0 | 전국 복지 데이터 분석 시스템</title>
    
    <!-- Fonts -->
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- ============================================
     SUSPENSION BAR (상단 검색 시스템)
     ============================================ -->
<nav class="suspension-bar">
    <div class="bar-content">
        <!-- Logo -->
        <div class="brand">
            <span class="brand-icon">📊</span>
            <span class="brand-text">SODAPOP</span>
        </div>
        
        <!-- Controls -->
        <div class="controls-row">
            <select id="yearSelect" class="ag-select compact">
                <option value="2025">2025</option>
                <option value="2024">2024</option>
                <option value="2023">2023</option>
                <option value="2022">2022</option>
                <option value="2021">2021</option>
            </select>
            
            <select id="sidoSelect" class="ag-select compact">
                <option value="">시/도 선택</option>
            </select>
            
            <select id="sigunguSelect" class="ag-select compact" disabled>
                <option value="">시/군/구</option>
            </select>
            
            <select id="dongSelect" class="ag-select compact" disabled>
                <option value="">읍/면/동</option>
            </select>
            
            <!-- 복지 대상 유형 선택 -->
            <select id="dataTypeSelect" class="ag-select compact">
                <option value="all">전체 인구</option>
                <option value="children">아동·청소년 (0-18)</option>
                <option value="youth">청년 (19-34)</option>
                <option value="middle">중장년 (35-64)</option>
                <option value="elderly">노인 (65+)</option>
                <option value="single">1인가구</option>
                <option value="multicultural">다문화가구</option>
                <option value="disabled">장애인</option>
                <option value="basic_livelihood">기초생활수급</option>
            </select>
            
            <button class="ag-btn-primary compact" id="runEngineBtn">
                🔍 분석
            </button>
        </div>
    </div>
</nav>

<!-- ============================================
     MAIN CONTENT
     ============================================ -->
<main class="content-canvas">
    <div class="container-fluid">
        
        <!-- Breadcrumb -->
        <nav class="ag-breadcrumb" id="breadcrumb">
            <span class="breadcrumb-item active">전국</span>
        </nav>

        <!-- ============================================
             복지서비스 자연어 검색
             ============================================ -->
        <div class="welfare-search-section">
            <div class="welfare-search-header">
                <span class="welfare-search-icon">🔎</span>
                <div>
                    <h2 class="welfare-search-title">복지서비스 검색</h2>
                    <p class="welfare-search-desc">궁금한 내용을 자연어로 입력하세요 — 예: "강동구 1인가구 현황", "노원구 기초수급자", "청년 취업 지원"</p>
                </div>
            </div>
            <div class="welfare-search-bar">
                <input
                    type="text"
                    id="welfareSearchInput"
                    class="welfare-search-input"
                    placeholder="지역명 또는 복지 키워드를 입력하세요..."
                    maxlength="100"
                />
                <button id="welfareSearchBtn" class="welfare-search-btn">
                    검색
                </button>
            </div>
            <!-- 빠른 검색 태그 -->
            <div class="welfare-quick-tags">
                <span class="quick-tag" data-q="기초생활수급 지원">기초생활수급</span>
                <span class="quick-tag" data-q="1인가구 지원">1인가구</span>
                <span class="quick-tag" data-q="노인 복지서비스">노인·어르신</span>
                <span class="quick-tag" data-q="장애인 지원">장애인</span>
                <span class="quick-tag" data-q="청년 취업 지원">청년</span>
                <span class="quick-tag" data-q="아동 보육 지원">아동</span>
                <span class="quick-tag" data-q="임산부 출산 지원">임산부</span>
                <span class="quick-tag" data-q="다문화가족 지원">다문화가족</span>
            </div>

            <!-- 검색 결과 패널 -->
            <div id="welfareSearchResults" class="welfare-results-panel" style="display:none;">
                <div class="welfare-results-header">
                    <span id="welfareResultsTitle" class="welfare-results-title"></span>
                    <span id="welfareResultsCount" class="welfare-results-count"></span>
                </div>
                <div id="welfareResultsList" class="welfare-results-list"></div>
                <div id="welfareResultsPager" class="welfare-results-pager" style="display:none;">
                    <button id="welfarePrevBtn" class="pager-btn" disabled>이전</button>
                    <span id="welfarePagerInfo" class="pager-info"></span>
                    <button id="welfareNextBtn" class="pager-btn">다음</button>
                </div>
            </div>
        </div>

        <!-- ============================================
             통계 카드 (Stats Cards)
             ============================================ -->
        <div class="stats-grid">
            <!-- Stat 1: 총 인구 / 대상 인구 -->
            <div class="stat-card primary">
                <div class="stat-label">
                    <span id="stat1Icon">👥</span>
                    <span id="stat1Label">총 인구 (추계)</span>
                </div>
                <div class="stat-value" id="stat1Value">51.2만</div>
                <div class="stat-sub" id="stat1Sub">전국 기준</div>
            </div>
            
            <!-- Stat 2: 주요 지표 -->
            <div class="stat-card rose">
                <div class="stat-label">
                    <span id="stat2Icon">👶</span>
                    <span id="stat2Label">기준 인구 수</span>
                </div>
                <div class="stat-value">
                    <span id="stat2Value">85.0k</span>
                    <span class="stat-change down" id="stat2Change">▼ 2.1%</span>
                </div>
                <div class="stat-sub" id="stat2Sub">전년 대비</div>
            </div>
            
            <!-- Stat 3: 비율 -->
            <div class="stat-card emerald">
                <div class="stat-label">
                    <span id="stat3Icon">📊</span>
                    <span id="stat3Label">비율</span>
                </div>
                <div class="stat-value" id="stat3Value">16.6%</div>
                <div class="stat-sub" id="stat3Sub">전국 평균 대비</div>
            </div>
            
            <!-- Stat 4: 긴급도 / 지수 -->
            <div class="stat-card amber">
                <div class="stat-label">
                    <span>🎯</span>
                    <span id="stat4Label">복지 긴급도</span>
                </div>
                <div class="stat-value" id="stat4Value">24.1</div>
                <div class="stat-sub" id="stat4Sub">전국 순위 기준</div>
            </div>
        </div>

        <!-- ============================================
             차트 영역 1: 인구 추이 & 비율 변화
             ============================================ -->
        <div class="population-trend-section">
            <!-- 지역별 인구 변화 추이 -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <span class="icon">📈</span>
                        지역별 인구 변화 추이 (2014-2023)
                    </h3>
                    <select id="trendMetric" class="select-sm">
                        <option value="totalPop">총인구</option>
                        <option value="childRatio">아동·청소년</option>
                        <option value="youthRatio">청년</option>
                        <option value="elderlyRatio">노인</option>
                    </select>
                </div>
                <div class="chart-body">
                    <div class="chart-container" style="height: 280px;">
                        <canvas id="populationTrendChart"></canvas>
                    </div>
                    <div class="chart-legend">
                        <div class="legend-item">
                            <span class="legend-dot" style="background: var(--primary)"></span>
                            <span id="trendLegendLabel">선택 지역</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-dot" style="background: var(--text-muted)"></span>
                            <span>전국 평균</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 비율 변화 추이 -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <span class="icon">📉</span>
                        <span id="ratioChartTitle">비율 변화 추이 (%)</span>
                    </h3>
                </div>
                <div class="chart-body">
                    <div class="chart-container" style="height: 280px;">
                        <canvas id="ratioTrendChart"></canvas>
                    </div>
                    <p class="text-muted text-secondary mt-3" style="font-size: 0.75rem;" id="ratioChartNote">
                        📍 2021년 기준 16.5%에서 매년 상승 추세, 전국 평균 상회
                    </p>
                </div>
            </div>
        </div>

        <!-- ============================================
             차트 영역 2: 인구 구조 변화 (Stacked Bar)
             ============================================ -->
        <div class="chart-card composition-chart">
            <div class="chart-header">
                <h3 class="chart-title">
                    <span class="icon">📊</span>
                    인구 구조 구성비 변화
                </h3>
                <span class="badge primary" id="compositionBadge">전 세대 분석</span>
            </div>
            <div class="chart-body">
                <div class="chart-container" style="height: 200px;">
                    <canvas id="compositionChart"></canvas>
                </div>
                <div class="composition-legend">
                    <div class="composition-legend-item">
                        <span class="legend-dot" style="background: var(--chart-elderly)"></span>
                        <span>노인 (65+)</span>
                    </div>
                    <div class="composition-legend-item">
                        <span class="legend-dot" style="background: var(--chart-middle)"></span>
                        <span>중장년 (35-64)</span>
                    </div>
                    <div class="composition-legend-item">
                        <span class="legend-dot" style="background: var(--chart-youth)"></span>
                        <span>청년 (19-34)</span>
                    </div>
                    <div class="composition-legend-item">
                        <span class="legend-dot" style="background: var(--chart-children)"></span>
                        <span>아동·청소년 (0-18)</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================
             하단 영역: 분포 차트 & 순위
             ============================================ -->
        <div class="dashboard-grid">
            <!-- 세대별 분포 (Doughnut) -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <span class="icon">🎯</span>
                        전 세대 복지 대상 분포
                    </h3>
                </div>
                <div class="chart-body">
                    <div class="d-flex gap-4">
                        <div class="chart-container" style="width: 180px; height: 180px;">
                            <canvas id="clusterChart"></canvas>
                        </div>
                        <div class="cluster-breakdown" id="clusterBreakdown">
                            <!-- JS에서 동적 생성 -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 복지 긴급도 순위 -->
            <div class="chart-card ranking-card">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <span class="icon">🏆</span>
                        복지 긴급도 순위
                    </h3>
                    <select id="rankingScope" class="select-sm">
                        <option value="sigungu">시군구별</option>
                        <option value="sido">시도별</option>
                    </select>
                </div>
                <div class="ranking-list" id="rankingList">
                    <!-- JS에서 동적 생성 -->
                </div>
            </div>
        </div>

        <!-- ============================================
             AI 분석 리포트 섹션
             ============================================ -->
        <div class="ai-report-section">
            <div class="ai-report-header">
                <div class="ai-icon">✨</div>
                <h3>Gemini AI 심층 분석</h3>
            </div>
            
            <div class="ai-report-body">
                <h4>📋 종합 현안</h4>
                <div class="report-text" id="aiReportSummary">
                    <p>지역과 복지 대상을 선택하시면 <strong>KOSIS 데이터 기반 심층 분석</strong>이 자동 생성됩니다.</p>
                </div>
                
                <div class="ai-report-grid">
                    <div class="ai-report-column">
                        <h5>⚠️ 주요 위험요소</h5>
                        <ul id="aiReportRisks">
                            <li>지역을 선택해주세요</li>
                        </ul>
                    </div>
                    <div class="ai-report-column">
                        <h5>✅ 필요한 복지 대책</h5>
                        <ul id="aiReportActions">
                            <li>분석 버튼을 클릭해주세요</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="ai-report-footer">
                <h5>🔮 향후 전망</h5>
                <p id="aiReportForecast">지역을 선택하면 맞춤형 전망이 생성됩니다.</p>
            </div>
            
            <div style="padding: var(--space-4) var(--space-5); border-top: 1px solid var(--border-light); display: flex; gap: var(--space-3);">
                <button class="ag-btn-primary" id="generateReportBtn" style="flex: 1;">
                    ✨ AI 분석 생성
                </button>
                <button class="ag-btn-primary" id="copyReportBtn" style="flex: 1; background: var(--text-secondary); display: none;">
                    📋 보고서 복사
                </button>
            </div>
        </div>
        
        <!-- Footer -->
        <footer style="text-align: center; padding: var(--space-6) 0; color: var(--text-muted); font-size: 0.75rem;">
            전국단위 인구·세대 복지 분석 데이터 대시보드 [Local Ver 3.0]<br>
            22.05.08 ver 1.0 ~ 배포일자 2025.01.15 - 개발자 : 박찬주, 배예진
        </footer>
        
    </div>
</main>

<!-- Toast Notification -->
<div class="ag-toast" id="toast">
    <span class="toast-icon">✓</span>
    <span class="toast-message" id="toastMessage">완료되었습니다</span>
</div>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner">
        <div class="spinner"></div>
        <span>데이터 분석 중...</span>
    </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="sodapop.js?v=5"></script>

</body>
</html>
