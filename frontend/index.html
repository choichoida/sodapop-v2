<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SODAPOP 2.0 | 전국 복지 데이터 분석 시스템</title>
    
    <!-- Fonts -->
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Custom Antigravity Styles -->
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- ============================================
     SUSPENSION BAR (Floating Navigation)
     ============================================ -->
<nav class="suspension-bar">
    <div class="container-fluid d-flex align-items-center gap-3">
        <div class="brand">
            <span class="brand-icon">📊</span>
            <span class="brand-text">SODAPOP <span class="version">2.0</span></span>
        </div>
        
        <div class="filter-group d-flex gap-2 ms-auto align-items-center">
            <!-- Year Select -->
            <select id="yearSelect" class="form-select ag-select">
                <option value="2025">2025년</option>
                <option value="2024">2024년</option>
                <option value="2023">2023년</option>
                <option value="2022">2022년</option>
                <option value="2021">2021년</option>
            </select>
            
            <!-- Region Cascade -->
            <select id="sidoSelect" class="form-select ag-select">
                <option value="">시/도 선택</option>
            </select>
            <select id="sigunguSelect" class="form-select ag-select" disabled>
                <option value="">시/군/구 선택</option>
            </select>
            <select id="dongSelect" class="form-select ag-select" disabled>
                <option value="">읍/면/동 선택</option>
            </select>
            
            <!-- Keyword Search -->
            <div class="search-wrapper">
                <input type="text" id="keywordSearch" class="form-control ag-input" 
                       placeholder="검색 (예: 1인가구, 독거노인)">
                <span class="search-icon">🔍</span>
            </div>
            
            <!-- Action Button -->
            <button class="btn ag-btn-primary" id="runEngineBtn">
                <span class="btn-icon">⚡</span>
                데이터 엔진 실행
            </button>
        </div>
    </div>
</nav>

<!-- ============================================
     MAIN CONTENT CANVAS
     ============================================ -->
<main class="container-fluid py-4 content-canvas">
    
    <!-- Breadcrumb -->
    <nav class="ag-breadcrumb mb-4" id="breadcrumb">
        <span class="breadcrumb-item active">전국</span>
    </nav>

    <!-- Stats Row -->
    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="ag-stat-card">
                <div class="stat-icon">👥</div>
                <div class="stat-content">
                    <span class="stat-value" id="totalPopulation">51,700,000</span>
                    <span class="stat-label">총 인구</span>
                </div>
                <div class="stat-trend up" id="popTrend">
                    <span>▼ 0.2%</span>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="ag-stat-card warning">
                <div class="stat-icon">👴</div>
                <div class="stat-content">
                    <span class="stat-value" id="elderlyPopulation">9,930,000</span>
                    <span class="stat-label">고령인구 (65+)</span>
                </div>
                <div class="stat-trend up warning" id="elderlyTrend">
                    <span>▲ 4.2%/년</span>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="ag-stat-card danger">
                <div class="stat-icon">📈</div>
                <div class="stat-content">
                    <span class="stat-value" id="agingRatio">19.2%</span>
                    <span class="stat-label">고령화율</span>
                </div>
                <div class="stat-badge" id="agingBadge">고령사회</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="ag-stat-card">
                <div class="stat-icon">🎯</div>
                <div class="stat-content">
                    <span class="stat-value" id="urgencyScore">50</span>
                    <span class="stat-label">긴급도 점수</span>
                </div>
                <div class="urgency-meter">
                    <div class="meter-fill" id="urgencyMeter" style="width: 50%"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Grid -->
    <div class="row g-4">
        <!-- Left Column: Pyramid Chart -->
        <div class="col-lg-8">
            <div class="ag-card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title">
                        <span class="title-icon">💎</span>
                        지역 인구 구조 피라미드 (전 세대 비교)
                    </h5>
                    <div class="card-actions">
                        <button class="btn btn-sm ag-btn-outline" id="toggleCompare">
                            📊 전국 비교
                        </button>
                        <span class="badge ag-badge" id="compareStatus">비교 모드 OFF</span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="chart-container" style="height: 450px;">
                        <canvas id="pyramidChart"></canvas>
                    </div>
                    <div class="pyramid-legend">
                        <div class="legend-item male">
                            <span class="legend-color"></span>
                            <span>남성</span>
                        </div>
                        <div class="legend-item female">
                            <span class="legend-color"></span>
                            <span>여성</span>
                        </div>
                        <div class="legend-item elderly">
                            <span class="legend-color"></span>
                            <span>고령층 (65+)</span>
                        </div>
                        <div class="legend-item compare" id="compareLegend" style="display: none;">
                            <span class="legend-color"></span>
                            <span>전국 평균</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: Stats & Report -->
        <div class="col-lg-4">
            <div class="d-flex flex-column gap-4 h-100">
                
                <!-- Aging Index Card -->
                <div class="ag-card highlight-danger">
                    <div class="card-body">
                        <div class="text-muted small mb-1">현재 지역 고령화 지수</div>
                        <div class="d-flex align-items-end gap-2">
                            <h2 class="stat-value-lg text-danger mb-0" id="localAgingRatio">19.2%</h2>
                            <span class="trend-badge danger" id="agingTrendBadge">▲ 전국 평균</span>
                        </div>
                        <div class="mini-chart mt-3">
                            <canvas id="agingTrendMini" height="60"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Welfare Cluster Distribution -->
                <div class="ag-card flex-grow-1">
                    <div class="card-header">
                        <h6 class="card-title mb-0">
                            <span class="title-icon">🎯</span>
                            복지 타겟 인구 분포
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="chart-container" style="height: 180px;">
                            <canvas id="clusterChart"></canvas>
                        </div>
                        <div class="cluster-breakdown mt-3" id="clusterBreakdown">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- AI Report Card -->
                <div class="ag-card report-card">
                    <div class="card-header">
                        <h6 class="card-title mb-0">
                            <span class="title-icon">📝</span>
                            사업계획서용 당위성 근거
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="report-text" id="aiReport">
                            지역을 선택하시면 KOSIS 데이터 기반으로<br>
                            <strong>사업 필요성 근거 문구</strong>가 자동 생성됩니다.
                        </div>
                        <div class="report-actions mt-3">
                            <button class="btn ag-btn-outline w-100" id="generateReportBtn">
                                ✨ 근거 문구 생성
                            </button>
                            <button class="btn ag-btn-primary w-100 mt-2" id="copyReportBtn" style="display: none;">
                                📋 보고서 문구 복사하기
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Row: Trend & Rankings -->
    <div class="row g-4 mt-2">
        <!-- Trend Chart -->
        <div class="col-lg-6">
            <div class="ag-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="card-title mb-0">
                        <span class="title-icon">📈</span>
                        시계열 추세 분석 (2021-2025)
                    </h6>
                    <select id="trendMetric" class="form-select ag-select-sm">
                        <option value="agingRatio">고령화율</option>
                        <option value="oldOldRatio">후기고령 비율</option>
                        <option value="dependency">부양비</option>
                    </select>
                </div>
                <div class="card-body">
                    <div class="chart-container" style="height: 250px;">
                        <canvas id="trendChart"></canvas>
                    </div>
                    <div class="trend-summary d-flex gap-4 mt-3">
                        <div class="summary-item">
                            <span class="label">5년간 변화</span>
                            <span class="value text-danger" id="trendChange">+2.7%p</span>
                        </div>
                        <div class="summary-item">
                            <span class="label">연평균 증가율</span>
                            <span class="value" id="trendCAGR">+4.2%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rankings -->
        <div class="col-lg-6">
            <div class="ag-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="card-title mb-0">
                        <span class="title-icon">🏆</span>
                        복지 긴급도 순위
                    </h6>
                    <select id="rankingScope" class="form-select ag-select-sm">
                        <option value="sigungu">시군구별</option>
                        <option value="sido">시도별</option>
                    </select>
                </div>
                <div class="card-body">
                    <div class="ranking-list" id="rankingList">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Toast Notification -->
<div class="ag-toast" id="toast">
    <span class="toast-icon">✓</span>
    <span class="toast-message" id="toastMessage">복사되었습니다</span>
</div>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner">
        <div class="spinner"></div>
        <span>데이터 분석 중...</span>
    </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="sodapop.js"></script>

</body>
</html>
